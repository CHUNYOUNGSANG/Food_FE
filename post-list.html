<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œíŒ - ë§›ì§‘ê³µìœ </title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="header-logo">
                <span class="header-logo-icon">ğŸ½ï¸</span>
                <span>ë§›ì§‘ê³µìœ </span>
            </a>
            
            <nav class="header-nav">
                <a href="index.html" class="header-nav-link">í™ˆ</a>
                <a href="post-list.html" class="header-nav-link active">ê²Œì‹œíŒ</a>
                <a href="post-create.html" class="header-btn-primary header-btn">ë§›ì§‘ ê³µìœ í•˜ê¸°</a>
            </nav>
            
            <div class="header-user" id="headerUser">
                <div id="authButtons">
                    <button class="header-btn" onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
                </div>
                <div id="userInfo" class="hidden">
                    <div class="header-user-info" onclick="location.href='profile.html'">
                        <div class="header-user-avatar" id="userAvatar">U</div>
                        <span class="header-user-name" id="userName">ì‚¬ìš©ì</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="main-page">
        <div class="container">
            <section class="category-section">
                <h2 class="category-title">ì¹´í…Œê³ ë¦¬ í•„í„°</h2>
                <div class="category-filters">
                    <button class="category-btn active" data-category="all">ì „ì²´</button>
                    <button class="category-btn" data-category="í•œì‹">ğŸš í•œì‹</button>
                    <button class="category-btn" data-category="ì¤‘ì‹">ğŸ¥Ÿ ì¤‘ì‹</button>
                    <button class="category-btn" data-category="ì¼ì‹">ğŸ± ì¼ì‹</button>
                    <button class="category-btn" data-category="ì–‘ì‹">ğŸ ì–‘ì‹</button>
                    <button class="category-btn" data-category="ì¹´í˜">â˜• ì¹´í˜</button>
                    <button class="category-btn" data-category="ë””ì €íŠ¸">ğŸ° ë””ì €íŠ¸</button>
                    <button class="category-btn" data-category="ê¸°íƒ€">ğŸ½ï¸ ê¸°íƒ€</button>
                </div>
            </section>

            <section class="posts-section">
                <div class="posts-header">
                    <h2 class="posts-title">ì „ì²´ ê²Œì‹œê¸€</h2>
                </div>
                
                <div id="postsLoading" class="posts-loading hidden">
                    <div class="loading"></div>
                    <p>ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                
                <div id="postsGrid" class="posts-grid"></div>
                
                <div id="postsEmpty" class="posts-empty hidden">
                    <div class="posts-empty-icon">ğŸ”</div>
                    <h3>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>ì²« ë²ˆì§¸ ë§›ì§‘ì„ ê³µìœ í•´ë³´ì„¸ìš”!</p>
                </div>
            </section>
        </div>
    </main>

    <script type="module">
        import { getAllPosts, getPostsByCategory } from './js/api/api.js';
        
        document.addEventListener('DOMContentLoaded', async () => {
            await loadPosts();
            initEventListeners();
        });

        async function loadPosts(category = 'all') {
            const loading = document.getElementById('postsLoading');
            const grid = document.getElementById('postsGrid');
            const empty = document.getElementById('postsEmpty');
            
            loading.classList.remove('hidden');
            grid.innerHTML = '';
            empty.classList.add('hidden');
            
            try {
                let posts = category === 'all' ? await getAllPosts() : await getPostsByCategory(category);
                posts = Array.isArray(posts) ? posts : [posts];
                
                if (posts.length === 0) {
                    empty.classList.remove('hidden');
                } else {
                    grid.innerHTML = posts.map(post => createPostCard(post)).join('');
                }
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
                empty.classList.remove('hidden');
            } finally {
                loading.classList.add('hidden');
            }
        }

        function createPostCard(post) {
            const imageUrl = post.imageUrl || 'https://via.placeholder.com/400x300?text=No+Image';
            const stars = 'â­'.repeat(Math.floor(post.rating || 0));
            
            return `
                <a href="post-detail.html?id=${post.id}" class="post-card">
                    <div class="post-card-image-wrapper">
                        <img src="${imageUrl}" alt="${post.title}" class="post-card-image">
                        <span class="post-card-category">${post.foodCategory || 'ê¸°íƒ€'}</span>
                    </div>
                    <div class="post-card-content">
                        <h3 class="post-card-title">${post.title}</h3>
                        <div class="post-card-restaurant">ğŸ“ ${post.restaurantName || 'ì •ë³´ ì—†ìŒ'}</div>
                        <div class="post-card-rating">
                            <span class="post-card-rating-stars">${stars}</span>
                            <span class="post-card-rating-value">${(post.rating || 0).toFixed(1)}</span>
                        </div>
                        <div class="post-card-footer">
                            <div class="post-card-author">
                                <div class="post-card-author-avatar">
                                    ${(post.memberNickname || 'U')[0].toUpperCase()}
                                </div>
                                <span>${post.memberNickname || 'ìµëª…'}</span>
                            </div>
                            <div class="post-card-stats">
                                <span class="post-card-stat">ğŸ‘ï¸ ${post.viewCount || 0}</span>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        }

        function initEventListeners() {
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    await loadPosts(e.target.dataset.category);
                });
            });
        }
    </script>
</body>
</html>