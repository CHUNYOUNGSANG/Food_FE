<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§›ì§‘ê³µìœ  - ë‹¹ì‹ ì˜ ë§›ì§‘ì„ ê³µìœ í•˜ì„¸ìš”</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="header-logo">
                <span class="header-logo-icon">ğŸ½ï¸</span>
                <span>Food</span>
            </a>
            
            <nav class="header-nav">
                <a href="index.html" class="header-nav-link active">í™ˆ</a>
                <a href="post-list.html" class="header-nav-link">ê²Œì‹œíŒ</a>
                <a href="post-create.html" class="header-btn-primary header-btn">ë§›ì§‘ ê³µìœ í•˜ê¸°</a>
            </nav>
            
            <div class="header-user" id="headerUser">
                <!-- ë¡œê·¸ì¸ ì „ -->
                <div id="authButtons">
                    <button class="header-btn" onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
                </div>
                <!-- ë¡œê·¸ì¸ í›„ -->
                <div id="userInfo" class="hidden">
                    <div class="header-user-info" onclick="location.href='profile.html'">
                        <div class="header-user-avatar" id="userAvatar">U</div>
                        <span class="header-user-name" id="userName">ì‚¬ìš©ì</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-page">
        <div class="container">
            <!-- íˆì–´ë¡œ ì„¹ì…˜ -->
            <section class="hero-section">
                <h1 class="hero-title">ë‹¹ì‹ ì˜ ë§›ì§‘ì„ ê³µìœ í•˜ì„¸ìš” ğŸ´</h1>
                <p class="hero-subtitle">ë§›ìˆëŠ” ìŒì‹ê³¼ íŠ¹ë³„í•œ ìˆœê°„ì„ í•¨ê»˜ ë‚˜ëˆ ìš”</p>
                <div class="hero-search">
                    <input type="text" 
                           class="hero-search-input" 
                           placeholder="ë§›ì§‘ ì´ë¦„, ìŒì‹ ì¢…ë¥˜ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”..."
                           id="searchInput">
                    <button class="hero-search-btn" id="searchBtn">ğŸ”</button>
                </div>
            </section>

            <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
            <section class="category-section">
                <h2 class="category-title">ì¹´í…Œê³ ë¦¬</h2>
                <div class="category-filters">
                    <button class="category-btn active" data-category="all">ì „ì²´</button>
                    <button class="category-btn" data-category="í•œì‹">ğŸš í•œì‹</button>
                    <button class="category-btn" data-category="ì¤‘ì‹">ğŸ¥Ÿ ì¤‘ì‹</button>
                    <button class="category-btn" data-category="ì¼ì‹">ğŸ± ì¼ì‹</button>
                    <button class="category-btn" data-category="ì–‘ì‹">ğŸ ì–‘ì‹</button>
                    <button class="category-btn" data-category="ì¹´í˜">â˜• ì¹´í˜</button>
                    <button class="category-btn" data-category="ë””ì €íŠ¸">ğŸ° ë””ì €íŠ¸</button>
                    <button class="category-btn" data-category="ê¸°íƒ€">ğŸ½ï¸ ê¸°íƒ€</button>
                </div>
            </section>

            <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
            <section class="posts-section">
                <div class="posts-header">
                    <h2 class="posts-title">ì¸ê¸° ë§›ì§‘ ğŸ”¥</h2>
                </div>
                
                <!-- ë¡œë”© ìƒíƒœ -->
                <div id="postsLoading" class="posts-loading hidden">
                    <div class="loading"></div>
                    <p>ë§›ì§‘ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                
                <!-- ê²Œì‹œê¸€ ê·¸ë¦¬ë“œ -->
                <div id="postsGrid" class="posts-grid">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
                
                <!-- ë¹ˆ ìƒíƒœ -->
                <div id="postsEmpty" class="posts-empty hidden">
                    <div class="posts-empty-icon">ğŸ”</div>
                    <h3>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>ì²« ë²ˆì§¸ ë§›ì§‘ì„ ê³µìœ í•´ë³´ì„¸ìš”!</p>
                </div>
            </section>
        </div>
    </main>

    <!-- JavaScript -->
    <script type="module">
        import { getAllPosts, getPostsByCategory } from './js/api/api.js';
        
        let currentCategory = 'all';
        let allPosts = [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            initUser();
            await loadPosts();
            initEventListeners();
        });

        // ì‚¬ìš©ì ì •ë³´ ì´ˆê¸°í™”
        function initUser() {
            const memberId = localStorage.getItem('memberId');
            const memberNickname = localStorage.getItem('memberNickname');
            
            if (memberId && memberNickname) {
                document.getElementById('authButtons').classList.add('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('userName').textContent = memberNickname;
                document.getElementById('userAvatar').textContent = memberNickname[0].toUpperCase();
            }
        }

        // ê²Œì‹œê¸€ ë¡œë“œ
        async function loadPosts(category = 'all') {
            const loading = document.getElementById('postsLoading');
            const grid = document.getElementById('postsGrid');
            const empty = document.getElementById('postsEmpty');
            
            loading.classList.remove('hidden');
            grid.innerHTML = '';
            empty.classList.add('hidden');
            
            try {
                let posts;
                if (category === 'all') {
                    posts = await getAllPosts();
                } else {
                    posts = await getPostsByCategory(category);
                }
                
                allPosts = Array.isArray(posts) ? posts : [posts];
                
                if (allPosts.length === 0) {
                    empty.classList.remove('hidden');
                } else {
                    renderPosts(allPosts);
                }
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
                empty.classList.remove('hidden');
            } finally {
                loading.classList.add('hidden');
            }
        }

        // ê²Œì‹œê¸€ ë Œë”ë§
        function renderPosts(posts) {
            const grid = document.getElementById('postsGrid');
            grid.innerHTML = posts.map(post => createPostCard(post)).join('');
        }

        // ê²Œì‹œê¸€ ì¹´ë“œ ìƒì„±
        function createPostCard(post) {
            const imageUrl = post.imageUrl || 'https://via.placeholder.com/400x300?text=No+Image';
            const stars = 'â­'.repeat(Math.floor(post.rating || 0));
            
            return `
                <a href="post-detail.html?id=${post.id}" class="post-card">
                    <div class="post-card-image-wrapper">
                        <img src="${imageUrl}" alt="${post.title}" class="post-card-image">
                        <span class="post-card-category">${post.foodCategory || 'ê¸°íƒ€'}</span>
                    </div>
                    <div class="post-card-content">
                        <h3 class="post-card-title">${post.title}</h3>
                        <div class="post-card-restaurant">
                            ğŸ“ ${post.restaurantName || 'ì •ë³´ ì—†ìŒ'}
                        </div>
                        <div class="post-card-rating">
                            <span class="post-card-rating-stars">${stars}</span>
                            <span class="post-card-rating-value">${(post.rating || 0).toFixed(1)}</span>
                        </div>
                        <div class="post-card-footer">
                            <div class="post-card-author">
                                <div class="post-card-author-avatar">
                                    ${(post.memberNickname || 'U')[0].toUpperCase()}
                                </div>
                                <span>${post.memberNickname || 'ìµëª…'}</span>
                            </div>
                            <div class="post-card-stats">
                                <span class="post-card-stat">ğŸ‘ï¸ ${post.viewCount || 0}</span>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
        function initEventListeners() {
            // ì¹´í…Œê³ ë¦¬ í•„í„°
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const category = e.target.dataset.category;
                    currentCategory = category;
                    await loadPosts(category);
                });
            });

            // ê²€ìƒ‰
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            
            const handleSearch = () => {
                const keyword = searchInput.value.trim().toLowerCase();
                if (keyword) {
                    const filtered = allPosts.filter(post => 
                        post.title.toLowerCase().includes(keyword) ||
                        post.restaurantName?.toLowerCase().includes(keyword) ||
                        post.content?.toLowerCase().includes(keyword)
                    );
                    renderPosts(filtered);
                } else {
                    renderPosts(allPosts);
                }
            };
            
            searchBtn.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
        }
    </script>
</body>
</html>