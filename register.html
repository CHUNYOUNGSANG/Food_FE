<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì… - ë§›ì§‘ê³µìœ </title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/login.css">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="header-logo">
                <span class="header-logo-icon">ğŸ½ï¸</span>
                <span>ë§›ì§‘ê³µìœ </span>
            </a>
            
            <nav class="header-nav">
                <a href="index.html" class="header-nav-link">í™ˆ</a>
                <a href="post-list.html" class="header-nav-link">ê²Œì‹œíŒ</a>
            </nav>
            
            <div class="header-user">
                <button class="header-btn" onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </header>

    <main class="auth-page">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-logo">ğŸ½ï¸</div>
                <h1 class="auth-title">íšŒì›ê°€ì…</h1>
                <p class="auth-subtitle">ë§›ì§‘ ê³µìœ ì˜ ì‹œì‘</p>
            </div>

            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label for="email" class="form-label">ì´ë©”ì¼ *</label>
                    <input 
                        type="email" 
                        id="email" 
                        class="form-input" 
                        placeholder="example@email.com"
                        required>
                    <span class="validation-check hidden" id="emailCheck"></span>
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸ *</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="form-input" 
                        placeholder="ì˜ë¬¸, ìˆ«ì í¬í•¨ 8ì ì´ìƒ"
                        required>
                    <span class="form-helper">ì˜ë¬¸, ìˆ«ì ì¡°í•© 8ì ì´ìƒ</span>
                </div>

                <div class="form-group">
                    <label for="passwordConfirm" class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label>
                    <input 
                        type="password" 
                        id="passwordConfirm" 
                        class="form-input" 
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
                        required>
                </div>

                <div class="form-group">
                    <label for="name" class="form-label">ì´ë¦„ *</label>
                    <input 
                        type="text" 
                        id="name" 
                        class="form-input" 
                        placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                        minlength="2"
                        maxlength="50"
                        required>
                </div>

                <div class="form-group">
                    <label for="nickname" class="form-label">ë‹‰ë„¤ì„ *</label>
                    <input 
                        type="text" 
                        id="nickname" 
                        class="form-input" 
                        placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
                        minlength="2"
                        maxlength="50"
                        required>
                    <span class="validation-check hidden" id="nicknameCheck"></span>
                </div>

                <button type="submit" class="auth-submit-btn">íšŒì›ê°€ì…</button>
            </form>

            <div class="auth-footer">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? 
                <a href="login.html" class="auth-footer-link">ë¡œê·¸ì¸í•˜ê¸°</a>
            </div>
        </div>
    </main>

    <script type="module">
        import { registerMember, checkEmailDuplicate, checkNicknameDuplicate } from './js/api/api.js';
        
        let emailValid = false;
        let nicknameValid = false;

        // ì´ë©”ì¼ ì¤‘ë³µ ê²€ì‚¬
        document.getElementById('email').addEventListener('blur', async function() {
            const email = this.value;
            const emailCheck = document.getElementById('emailCheck');
            
            if (!email) return;
            
            try {
                const isDuplicate = await checkEmailDuplicate(email);
                if (isDuplicate) {
                    emailCheck.textContent = 'âŒ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤';
                    emailCheck.className = 'validation-check error';
                    emailValid = false;
                } else {
                    emailCheck.textContent = 'âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤';
                    emailCheck.className = 'validation-check success';
                    emailValid = true;
                }
                emailCheck.classList.remove('hidden');
            } catch (error) {
                console.error('ì´ë©”ì¼ ê²€ì‚¬ ì‹¤íŒ¨:', error);
            }
        });

        // ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬
        document.getElementById('nickname').addEventListener('blur', async function() {
            const nickname = this.value;
            const nicknameCheck = document.getElementById('nicknameCheck');
            
            if (!nickname || nickname.length < 2) return;
            
            try {
                const isDuplicate = await checkNicknameDuplicate(nickname);
                if (isDuplicate) {
                    nicknameCheck.textContent = 'âŒ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤';
                    nicknameCheck.className = 'validation-check error';
                    nicknameValid = false;
                } else {
                    nicknameCheck.textContent = 'âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤';
                    nicknameCheck.className = 'validation-check success';
                    nicknameValid = true;
                }
                nicknameCheck.classList.remove('hidden');
            } catch (error) {
                console.error('ë‹‰ë„¤ì„ ê²€ì‚¬ ì‹¤íŒ¨:', error);
            }
        });

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        document.getElementById('passwordConfirm').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            if (this.value && this.value !== password) {
                this.classList.add('error');
            } else {
                this.classList.remove('error');
            }
        });

        // íšŒì›ê°€ì… ì œì¶œ
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const password = document.getElementById('password').value;
            const passwordConfirm = document.getElementById('passwordConfirm').value;
            
            if (password !== passwordConfirm) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/;
            if (!passwordPattern.test(password)) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸, ìˆ«ìë¥¼ í¬í•¨í•˜ì—¬ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            const memberData = {
                email: document.getElementById('email').value,
                password: password,
                name: document.getElementById('name').value,
                nickname: document.getElementById('nickname').value
            };

            try {
                await registerMember(memberData);
                alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                window.location.href = 'login.html';
            } catch (error) {
                console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', error);
                alert('íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        });
    </script>
</body>
</html>